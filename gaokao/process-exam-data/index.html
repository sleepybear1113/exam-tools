<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>考试数据处理 - 报名数据统计</title>
	<link rel="stylesheet" href="../../lib/bootstrap/5.3.8/bootstrap.min.css">
	<link rel="stylesheet" href="./style.css">
</head>
<body>
	<div class="container py-4" id="app">
		<h1 class="h4 mb-3">考试数据处理</h1>
		<div class="alert alert-info small mb-4">
			上传 .xls / .xlsx 报名数据，根据文件自动识别学选考或高考格式，统计县区、报名点维度的学考 / 选考 / 外语或术科情况。表头将自动大写并截取下划线前缀以适配不同模板。
		</div>

		<div class="row g-3">
			<div class="col-md-6">
				<div class="d-flex justify-content-between align-items-center">
					<label for="bmdMappingInput" class="form-label mb-0">报名点代码映射</label>
					<button class="btn btn-sm btn-outline-secondary" id="btnResetBmd">重置为默认</button>
				</div>
				<textarea class="form-control mapping-input" id="bmdMappingInput" rows="6"></textarea>
				<div class="form-text">格式：报名点代码（前缀匹配县区代码）&nbsp;&nbsp;报名点名称，支持空格或 Tab 分隔，实时保存到浏览器。</div>
			</div>
			<div class="col-md-6">
				<div class="d-flex justify-content-between align-items-center">
					<label for="countyMappingInput" class="form-label mb-0">县区代码映射</label>
					<button class="btn btn-sm btn-outline-secondary" id="btnResetCounty">重置为默认</button>
				</div>
				<textarea class="form-control mapping-input" id="countyMappingInput" rows="6"></textarea>
				<div class="form-text">格式：县区代码&nbsp;&nbsp;县区名称，将第二至第三位作为县区代码，映射不到将不会显示。</div>
			</div>
		</div>

		<div class="d-flex flex-wrap gap-2 align-items-center mt-3">
			<button class="btn btn-primary" id="btnToggleMode" disabled>切换至复制模式</button>
			<button class="btn btn-outline-secondary" id="btnClear">清空结果</button>
			<span class="small text-muted ms-auto" id="statusLine">等待上传文件…</span>
		</div>

		<div class="dropzone mt-3" id="dropzone">
			<div class="dz-inner text-muted">
				拖动 .xls / .xlsx 文件到此处（或直接拖到页面任意位置），也可
				<button class="btn btn-link p-0 align-baseline" id="btnPick">选择文件</button>
				<input type="file" class="d-none" id="fileInput" accept=".xls,.xlsx">
			</div>
		</div>

		<div class="mt-3" id="tableWrapper">
			<div class="table-responsive">
				<table class="table table-bordered table-sm align-middle" id="resultTable">
					<thead></thead>
					<tbody>
						<tr>
							<td class="text-center text-muted" colspan="5">暂无数据</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="mt-3 d-none" id="copyWrapper">
			<label class="form-label" for="copyOutput">复制模式（Tab 分隔，直接粘贴至 Excel）</label>
			<textarea class="form-control" id="copyOutput" rows="10" readonly></textarea>
		</div>

		<div id="loadingOverlay" class="loading-overlay d-none" role="status" aria-live="polite">
			<div class="loading-content">
				<div class="spinner-border text-primary" role="status" aria-hidden="true"></div>
				<div class="mt-2 text-secondary small" id="loadingText">正在处理，请稍候…</div>
			</div>
		</div>
	</div>

	<script src="../../lib/bootstrap/5.3.8/bootstrap.bundle.min.js"></script>
	<script src="../../lib/sheetjs/0.20.3/xlsx.full.min.js"></script>
	<script src="./app.js"></script>
</body>
</html>

